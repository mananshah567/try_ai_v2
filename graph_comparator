import pandas as pd
from decimal import Decimal, InvalidOperation

def _safe_str(v):
    if v is None: return ''
    s = str(v).strip()
    return '' if s.lower() in ('nan','none') else s

def _iter_rows(df_or_rows):
    return df_or_rows.itertuples(index=False, name='Row') if isinstance(df_or_rows, pd.DataFrame) else df_or_rows

# ---------- Vertex (ID-only) ----------

# vertex IDs from DF
ids_df = (
    df_vertices['ID']
      .astype('string')      # pandas nullable string dtype (keeps <NA>)
      .str.strip()
      .dropna()
)
want_vertex_ids = set(ids_df[ids_df.ne('')])

# diffs vs graph
existing_vertex_ids = set(existing_vertex_ids)  # from your loader
to_upload_vertices = want_vertex_ids - existing_vertex_ids
to_delete_vertices = existing_vertex_ids - want_vertex_ids


edge_ids_df = (
    df_edges['edge_id']      # or whatever the column is called
      .astype('string')
      .str.strip()
      .dropna()
)
want_edge_ids = set(edge_ids_df[edge_ids_df.ne('')])

existing_edge_ids = set(existing_edge_ids)      # from your edge loader
to_upload_edges = want_edge_ids - existing_edge_ids
to_delete_edges = existing_edge_ids - want_edge_ids
